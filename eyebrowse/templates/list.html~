{% extends "base.html" %}
{% block title %}Past 30 Days{% endblock %}
{% block imports %}
        <script src="http://zamiang.webfactional.com/lib/js/jquery-1.3.2.min.js">
        </script>
        <script src="http://zamiang.webfactional.com/lib/js/protocrock.js">
        </script>
        <script src="http://zamiang.webfactional.com/lib/js/zamiang.js">
        </script>
        <script src="http://zamiang.webfactional.com/lib/js/watchMeGraph.js">
        </script>
        <script src="http://zamiang.webfactional.com/lib/js/canvas.text.js">
        </script>
        <script src="http://zamiang.webfactional.com/lib/js/faces/helvetiker-normal-normal.js">
        </script>
        <script>
            jQuery.noConflict();
        </script>
        <script>
            function getListIt(){
                try {
                    netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
                } 
                catch (e) {
                }
                return Components.classes['@electronic.max/listit;1'].getService().wrappedJSObject;
            };
            
            var WatchmeVisualisation = {
	          initialize: function(canvas, windowWidth, windowHeight, timeZoneCorrect, zoom){
                    this.canvas = canvas;
                    this.windowWidth = windowWidth;
                    this.windowHeight = windowHeight;
                    this.timeZoneCorrect = timeZoneCorrect;
		        this.endDate = new Date(new Date().valueOf());
			    var day = 86400000;

                    this.startDate = new Date(this.endDate.valueOf() - day);
                    this.now = new Date(new Date().valueOf() + this.timeZoneCorrect);
                    this.endTime = this.endDate.valueOf();
                    this.startTime = this.startDate.valueOf();
                    this.OGendTime = this.endDate.valueOf();
                    this.OGstartTime = this.startDate.valueOf();
                    this.interp = zoom / 192;
                    this.drag = undefined;
                    this.zoom = zoom;

                    var listit = getListIt();
                    this.listit = listit;
                    
                    var statusArray = [];
                    this.drawArray = [];
                    
		        var wwwBarsArray = [];
			    var fooDate = "";
			        var fooTotal = "";
				    for (var i = 0; i < (zoom/day); i++){    
				          wwwBarsArray[i] = newify(statusFactory, this, {
					  startTime: this.startTime - (day * i),
					  endTime : this.endTime - (day * i),
					  xOffset: 0,
					  yOffset: 0,
					          marginTop: 25 * i + 22,
						  height: 20,
						          color: "#0000ff",            
							  static: true,
							  data: this.listit.CMS.event_store.getEvents("www-viewed", [this.startTime - (day * i), this.endTime - (day * i)])
							        });
								      fooDate += new Date(wwwBarsArray[i].endTime).format('dddd, mmmm d') + "<br />";
								            fooTotal += function(){
									    var foo = 1;
									    for (var j = 0; j < wwwBarsArray[i].data.length; j++){
									      foo += wwwBarsArray[i].data[j].end - wwwBarsArray[i].data[j].start;
									      }
									      return timeCounterLongAbv(foo / 1000) + "<br />";
									      }();
									          }
										      this.drawArray.push(wwwBarsArray);
										          jQuery("#fooDate").html(fooDate);
											      jQuery("#fooTotal").html(fooTotal);
                    mainEvtHandlers = newify(evtHandlers, this);
                    this.draw();
                },
                draw: function(){
                    if (this.canvas !== undefined && this.canvas.getContext) {
                        var ctx = this.canvas.getContext('2d');
                        ctx.clearRect(0, 0, this.windowWidth, this.windowHeight);
                        for (var i = 0; i < this.drawArray.length; i++) {
                            for (var k = 0; k < this.drawArray[i].length; k++) {
                                this.drawArray[i][k].draw();
                            }
                        }
                    }
                    else {
                        alert('You need Safari 4 or Firefox 3+ to see this.');
                    }
                },
                getCanvas: function(){
                    return this.canvas;
                },
                setDrawArray: function(p){
                    this.drawArray = p;
                }
            };
            
            
            jQuery(document).ready(function(){
                var myWidth = undefined;
                var myHeight = undefined;
                
                myWidth = window.innerWidth - 350;
                myHeight = 400;//window.innerHeight;
                
                document.getElementById("main").setAttribute("width", myWidth);
                document.getElementById("main").setAttribute("height", myHeight);
                
                self.viz = newify(WatchmeVisualisation, document.getElementById("main"), myWidth, myHeight, 0, 1296000000);
            });
        </script>
{% endblock %}
{% block content %}
        <div id="hai" class="bottombar">
            <h1>UrName </h1>
            <div id="infoz">
                <div id="totalTime">
                </div>
                <div id="avgTime">
                </div>
                filter by: 
                <br/>
            </div>
        </div>
        <div id="listNav">
            sort: <a href="#name" onclick="window.viz.sortByName()">name</a>&nbsp | &nbsp<a href="#domain" onclick="window.viz.sortByDomain()">domain</a>&nbsp | &nbsp<a href="#time" onclick="window.viz.sortByTime()">time spent</a>
        </div>
        <div id="list">
        </div>

{% endblock %}
